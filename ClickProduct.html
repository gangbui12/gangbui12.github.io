<!DOCTYPE html>
<html>

<head>
	<title>IPFS Image Upload</title>

	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="https://cdn.rawgit.com/ethereum/web3.js/develop/dist/web3.js"></script>
	<script src="https://cdn.rawgit.com/ethereumjs/browser-builds/ddb27f8d/dist/ethereumjs-tx/ethereumjs-tx-1.3.3.min.js"></script>
	<script src="https://unpkg.com/ipfs-api/dist/index.min.js"></script>

	<link rel="stylesheet" href="assets/css/style.min.css">
	<link rel="stylesheet" href="assets/css/modules.css">

	<style>
	</style>

</head>

<body>

	<!-- <section class="MOD_HERO" style="background-image:url(https://unsplash.it/1400/?random)"> -->
	<section class="MOD_HERO" style="background-image:url(assets/css/3.png)">
		<div data-layout="_r">
			<div data-layout="de10">
				<h1>상품 정보</h1>
				<h3>상품의 자세한 정보를 가져옵니다</h3>

			</div>
		</div>
	</section>
	<section class="MOD_MENU" data-theme="_bgp">
		<div data-layout="_r" class="nopadding">
			<nav class="MOD_MENU_Nav">
				<p class="MOD_MENU_Title">Menu</p>

				<svg class="MOD_MENU_Button" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="30px" height="30px" viewBox="0 0 30 30"
				 enable-background="new 0 0 30 30" xml:space="preserve"> -->
					<rect width="30" height="6" />
					<rect y="24" width="30" height="6" />
					<rect y="12" width="30" height="6" />
				</svg>

				<ul class="AP_Menu_List">
					<li>
							<a href="#" data-theme="_bgp" style="background-image: url(assets/css/Home.png);background-repeat: no-repeat; background-size: contain; 	background-position: center;" onclick="self.location='http://192.168.0.77:7001/newnewnew/Main.html';"></a>
					</li>
					<li>
						<a href="#" data-theme="_bgp">마이페이지 </a>
						<ul>
							<li>
								<a href="#" data-theme="_bgpd" onclick="self.location='http://192.168.0.77:7001/newnewnew/MyDocument.html';">내 서류</a>
							</li>
							<li>
								<a href="#" data-theme="_bgpd" onclick="self.location='http://192.168.0.77:7001/newnewnew/UploadDocument.html';">서류 등록</a>
							</li>
							<li>
								<a href="#" data-theme="_bgpd">서류 열람 허가</a>
							</li>
						</ul>
					</li>
					<li>
						<a href="#" data-theme="_bgp">판매자</a>
						<ul>
							<li>
								<a href="#" onclick="self.location='http://192.168.0.77:7001/newnewnew/UploadProduct.html';" data-theme="_bgpd">매물 등록</a>
							</li>
							<li>
								<a href="#" onclick="self.location='http://192.168.0.77:7001/newnewnew/UpdateProduct.html';" data-theme="_bgpd">매물 변경</a>
							</li>
							<li>
								<a href="#" data-theme="_bgpd">내 매물</a>
							</li>
						</ul>
					</li>

					<li>
						<a href="#" data-theme="_bgp">구매자</a>

					</li>

					<li>
						<a href="#" data-theme="_bgp">메뉴 4</a>
					</li>
					<li>
						<a href="#" data-theme="_bgp">메뉴 5</a>
					</li>
					<li>
						<a href="#" data-theme="_bgp">메뉴 6</a>
						<ul>
							<li>
								<a href="#" data-theme="_bgpd">Sub-Menu Item</a>
							</li>
							<li>
								<a href="#" data-theme="_bgpd">Sub-Menu Item long title</a>
							</li>
							<li>
								<a href="#" data-theme="_bgpd">Sub-Menu Item</a>
							</li>
						</ul>
					</li>
				</ul>
			</nav>
		</div>
	</section>
	<section class="MOD_SUBNAVIGATION1">
		<div data-layout="_r">
			<div data-layout="al16 al-o2 de-o1 de6 ec4">
				<nav class="MOD_SUBNAVIGATION1_Menu" data-theme="_bo2">
					<p class="MOD_SUBNAVIGATION1_Menutitle" data-theme="_bgs"></p>
					<ul>
						<li>
							<a href="#">ALL</a>
						</li>
						<li>
							<a href="#">아파트</a>
						</li>
						<li>
							<a href="#">빌라</a>
						</li>
						<li>
							<a href="#">주택</a>
						</li>
						<li>
							<a href="#">미정</a>
						</li>
						<li>
							<a href="#">미정</a>
						</li>
						<li>
							<a href="#">미정</a>
						</li>

					</ul>
				</nav>
			</div>

			<div data-layout="al-o1 de-o2 de10" class="MOD_SUBNAVIGATION1_Page">
				<section class="MOD_PROMOBOX1">
					<div id="Pic" data-layout="_r" class="MOD_PROMOBOX1_Background">
						<div data-layout="al16 de8" class="MOD_PROMOBOX1_Blank">
						</div>
						<div data-layout="al16 de8" class="MOD_PROMOBOX1_Content">
							<p id="proname"></p>
							<p id="proaddr"></p>
							<p id="proprice"></p>
							<p id="proowner"></p>
							<p id="protell"></p>
							<p id="Status_Numberofpeople"></p>
							<p id="Status_avg"></p>
							<p id="proinfo"></p>
						</div>
					</div>
		
				</section>
				<div class="subpics" id="subPic"></div>
				<button class="custombutom" onMouseover="this.style.color='red';" onMouseout="this.style.color='black';">
					구매하기
				</button>
				<button  onclick="OnClickAddFavoriteProduct()" class="custombutom2" onMouseover="this.style.color='red';" onMouseout="this.style.color='black';">
					<div id="buttonname">찜</div>
				</button>
				
			</div>

		</div>

	</section>

</body>

<script type="text/javascript">
  var contractAddress = '0x1228d4fd1914fbdd4dabee785153da6d36a9a12e';
  var abi = [
	{
		"constant": false,
		"inputs": [
			{
				"name": "_index",
				"type": "uint256"
			}
		],
		"name": "favoriteProduct",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_trans",
				"type": "address"
			},
			{
				"name": "score",
				"type": "uint256"
			}
		],
		"name": "SellerEvaluation",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_applicant",
				"type": "address"
			},
			{
				"name": "_span",
				"type": "uint256"
			}
		],
		"name": "SetAllowMyDocument",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_name",
				"type": "string"
			},
			{
				"name": "_id",
				"type": "string"
			},
			{
				"name": "_tell",
				"type": "uint256"
			}
		],
		"name": "setBuyer",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_trans",
				"type": "address"
			},
			{
				"name": "buyer",
				"type": "address"
			},
			{
				"name": "seller",
				"type": "address"
			},
			{
				"name": "price",
				"type": "uint256"
			}
		],
		"name": "setRoomContract",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_name",
				"type": "string"
			},
			{
				"name": "_id",
				"type": "string"
			},
			{
				"name": "_tell",
				"type": "uint256"
			}
		],
		"name": "setSeller",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_index",
				"type": "uint256"
			},
			{
				"name": "myaddress",
				"type": "address"
			}
		],
		"name": "setTransOwner",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_index",
				"type": "uint256"
			},
			{
				"name": "_DocumentName",
				"type": "string"
			},
			{
				"name": "_DocumentImageHashsrc",
				"type": "string"
			},
			{
				"name": "_DocumentImageInfo",
				"type": "string"
			}
		],
		"name": "SetUpdateMyDocument",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "product_index",
				"type": "uint256"
			},
			{
				"name": "_ImageHashsrc",
				"type": "string"
			},
			{
				"name": "_ProductAddress",
				"type": "string"
			},
			{
				"name": "_ProductInfo",
				"type": "string"
			},
			{
				"name": "_Price",
				"type": "uint256"
			},
			{
				"name": "_Tag",
				"type": "string"
			},
			{
				"name": "_ProductName",
				"type": "string"
			}
		],
		"name": "SetUpdateProduct",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_DocumentName",
				"type": "string"
			},
			{
				"name": "_DocumentImageHashsrc",
				"type": "string"
			},
			{
				"name": "_DocumentImageInfo",
				"type": "string"
			}
		],
		"name": "SetUploadMyDocument",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "_ImageHashsrc",
				"type": "string"
			},
			{
				"name": "_ProductAddress",
				"type": "string"
			},
			{
				"name": "_ProductInfo",
				"type": "string"
			},
			{
				"name": "_Price",
				"type": "uint256"
			},
			{
				"name": "_Tag",
				"type": "string"
			},
			{
				"name": "_ProductName",
				"type": "string"
			}
		],
		"name": "SetUploadProduct",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"name": "buyerDetail",
		"outputs": [
			{
				"name": "flag",
				"type": "bool"
			},
			{
				"name": "id",
				"type": "string"
			},
			{
				"name": "name",
				"type": "string"
			},
			{
				"name": "Tell",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"name": "DocumentArray",
		"outputs": [
			{
				"name": "DocumentName",
				"type": "string"
			},
			{
				"name": "DocumentImageHashsrc",
				"type": "string"
			},
			{
				"name": "DocumentImageInfo",
				"type": "string"
			},
			{
				"name": "Documentowner",
				"type": "address"
			},
			{
				"name": "Documentnumber",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "favoriteProductresult",
		"outputs": [
			{
				"name": "",
				"type": "uint256[]"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "_person",
				"type": "address"
			},
			{
				"name": "_index",
				"type": "uint256"
			}
		],
		"name": "getBuyerDocument",
		"outputs": [
			{
				"name": "_allowReference",
				"type": "bool"
			},
			{
				"name": "_approveBlockNo",
				"type": "uint256"
			},
			{
				"name": "_refLimitBlockNo",
				"type": "uint256"
			},
			{
				"name": "_applicant",
				"type": "address"
			},
			{
				"name": "_DocumentName",
				"type": "string"
			},
			{
				"name": "_DocumentImageHashsrc",
				"type": "string"
			},
			{
				"name": "_DocumentImageInfo",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "getDocumentList",
		"outputs": [
			{
				"name": "",
				"type": "uint256[]"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "_id",
				"type": "string"
			}
		],
		"name": "getMyAddress",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "_index",
				"type": "uint256"
			}
		],
		"name": "GetMyProduct",
		"outputs": [
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "address"
			},
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "GetMyProductnumber",
		"outputs": [
			{
				"name": "",
				"type": "uint256[]"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "GetProdctsSize",
		"outputs": [
			{
				"name": "count",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "_trans",
				"type": "address"
			}
		],
		"name": "getRoomContract",
		"outputs": [
			{
				"name": "",
				"type": "address"
			},
			{
				"name": "",
				"type": "address"
			},
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "getSellerScore",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "addr",
				"type": "address"
			}
		],
		"name": "getType",
		"outputs": [
			{
				"name": "",
				"type": "int256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "_index",
				"type": "uint256"
			}
		],
		"name": "IndexToOwner",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "_index",
				"type": "uint256"
			}
		],
		"name": "IndexToPrice",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"name": "productArray",
		"outputs": [
			{
				"name": "ProductAddress",
				"type": "string"
			},
			{
				"name": "ProductInfo",
				"type": "string"
			},
			{
				"name": "Price",
				"type": "uint256"
			},
			{
				"name": "Tag",
				"type": "string"
			},
			{
				"name": "ProductName",
				"type": "string"
			},
			{
				"name": "ImageHashsrc",
				"type": "string"
			},
			{
				"name": "owner",
				"type": "address"
			},
			{
				"name": "Productnumber",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"name": "sellerDetail",
		"outputs": [
			{
				"name": "flag",
				"type": "bool"
			},
			{
				"name": "Tell",
				"type": "uint256"
			},
			{
				"name": "reliability",
				"type": "uint256"
			},
			{
				"name": "Status_Numberofpeople",
				"type": "uint256"
			},
			{
				"name": "Status_sum",
				"type": "uint256"
			},
			{
				"name": "Status_avg",
				"type": "uint256"
			},
			{
				"name": "id",
				"type": "string"
			},
			{
				"name": "name",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	}
];
  var RealEstateTransactionContract;
  var RealEstateTransactionStorage;


  var imageArray = new Array();
  var Tag;
  var count = 0; //상품 배열 최대크기
  var index = 0; //인덱스용 (상품 삽입)
  var Productindex;


  window.addEventListener('load', function () {

    // Checking if Web3 has been injected by the browser (Mist/MetaMask)
    if (typeof web3 !== 'undefined') {
      // Use Mist/MetaMask's provider
      window.web3 = new Web3(web3.currentProvider);
    } else {
      console.log('No web3? You should consider trying MetaMask!')
      // fallback - use your fallback strategy (local node / hosted node + in-dapp id mgmt / fail)
      window.web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:7001"));
    }
    var catchindex = location.href.split("No.");
    Productindex = catchindex[1];
   
    // Now you can start your app & access web3 freely:
    startApp();
  });

  function startApp() {
    RealEstateTransactionContract = web3.eth.contract(abi);
    RealEstateTransactionStorage = RealEstateTransactionContract.at(contractAddress);

    //   document.getElementById('contractAddr').innerHTML = getLink(contractAddress);
    
     LoadProducts();

  }
  //모든 상품 불러오기
  function LoadProducts() {

          RealEstateTransactionStorage.productArray(Productindex, function (e, r) {
			
			imageArray = r[5].split('##');

            document.getElementById('proname').innerHTML = "상품이름 : "+r[4];
            document.getElementById('proinfo').innerHTML = "상품정보 : "+ r[1];
            document.getElementById('proaddr').innerHTML = "주 소 : "+ r[0];
           
            document.getElementById('proprice').innerHTML = "가 격 : "+ r[2]/10**18 +' <span style="color: blueviolet; font-weight:bold">ETH</span>';
            document.getElementById('proowner').innerHTML = "주 인 : "+ r[6];
	
             RealEstateTransactionStorage.sellerDetail(r[6],function(e,r){
              document.getElementById('protell').innerHTML = "Tell. : "+r[1];
              document.getElementById('Status_avg').innerHTML = "평 점 : " +r[5];
              document.getElementById('Status_Numberofpeople').innerHTML ="거래 회수 : "+ r[3];
		
             })
			 LoadImage();
        })
  }

  function LoadImage() {
	  var mainpic = 1;
	  for (var i = 0; i < imageArray.length-1; i++) {
		  if(imageArray[i].length > 15 && imageArray[i] != "")
		  {
			  if (mainpic > 0) {
				  var Pic = document.getElementById('Pic');
				  let ShowProducturl = "http://ipfs.io/ipfs/" + imageArray[i];
				  Pic.style = "background-image:url(" + ShowProducturl + ")";
			  }
			  
			  img = document.createElement('button');
			  let loadimageurl = "http://ipfs.io/ipfs/" + imageArray[i];
			  img.setAttribute("id","SubPic"+ i);
			  img.setAttribute("class","subpic");

			  img.setAttribute("onclick","OnClickSubPic(this.id)");
			  img.style = "background-image:url(" + loadimageurl + ")";
			  document.getElementById('subPic').appendChild(img);

			  mainpic = -1;
		  }

	  }

	}
	function OnClickSubPic(_id)
	{
		_id = _id.split('SubPic');
		var index = _id[1];
		var Pic = document.getElementById('Pic');
		let ShowProducturl = "http://ipfs.io/ipfs/" + imageArray[index];
		Pic.style = "background-image:url(" + ShowProducturl + ")";
	}
	function OnClickAddFavoriteProduct(){
		
		RealEstateTransactionStorage.favoriteProduct(Productindex,function(e,r){
			document.getElementById('buttonname').innerHTML = "등록중...";
			txid= r;
		});
		var filter = web3.eth.filter('latest');
		//등록 완료 통지
		filter.watch(function (e, r) {

			web3.eth.getTransaction(txid, function (e, r) {
				if (r != null && r.blockNumber > 0) {
					//(변경완료)
					document.getElementById('buttonname').innerHTML = "찜";
					filter.stopWatching();
				}
			});
		});

	}
  // //콤보박스 값 받아오기
  // function chageLangSelect() {
  //   var langSelect = document.getElementById("id-lang");
  //   //태그에 저장
  //   Tag = langSelect.options[langSelect.selectedIndex].text;
  // }
  function getLink(addr) {
    return '<a target="_blank" href=https://testnet.etherscan.io/address/' + addr + '>' + addr + '</a>';
  }
  

  
</script>

</html>
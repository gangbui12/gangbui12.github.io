<!DOCTYPE html>
<html>

<head>
  <title>IPFS Image Upload</title>

  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.rawgit.com/ethereum/web3.js/develop/dist/web3.js"></script>
  <script src="https://cdn.rawgit.com/ethereumjs/browser-builds/ddb27f8d/dist/ethereumjs-tx/ethereumjs-tx-1.3.3.min.js"></script>
  <script src="https://unpkg.com/ipfs-api/dist/index.min.js"></script>

  <link rel="stylesheet" href="assets/css/style.min.css">
  <link rel="stylesheet" href="assets/css/modules.css">

  <style>
  </style>

</head>

<body>
 <!-- <section class="MOD_HERO" style="background-image:url(https://unsplash.it/1400/?random)"> -->
  <section class="MOD_HERO" style="background-image:url(assets/css/3.png)">
    <div data-layout="_r">
      <div data-layout="de10">
        <h1>쇼 핑</h1>
        <h3>신나게 고르세욤</h3>
        
      </div>
    </div>
  </section>
	<section class="MOD_MENU" data-theme="_bgp">
		<div data-layout="_r" class="nopadding">
			<nav class="MOD_MENU_Nav">
				<!-- <p class="MOD_MENU_Title">Menu</p> -->
								
				<!-- <svg class="MOD_MENU_Button" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="30px" height="30px" viewBox="0 0 30 30" enable-background="new 0 0 30 30" xml:space="preserve">
					<rect width="30" height="6"/>
					<rect y="24" width="30" height="6"/>
					<rect y="12" width="30" height="6"/>
				</svg> -->

				<ul class="AP_Menu_List">
					<li>
						<a href="#" class="Homebtn" style="background-image: url(assets/css/Home.png);background-repeat: no-repeat; background-size: contain; 	background-position: center;" onclick="self.location='http://192.168.0.77:7001/newnewnew/Main.html';"></a>
					</li>
					<li>
							<a href="#" data-theme="_bgp">마이페이지 </a>
							<ul>
									<li>
										<a href="#" data-theme="_bgpd"  onclick="self.location='http://192.168.0.77:7001/newnewnew/FavoriteProducts.html';">찜 목록</a>
									</li>
									
									<li>
										<a href="#" data-theme="_bgpd" onclick="self.location='http://192.168.0.77:7001/newnewnew/MyDocument.html';" >내 서류</a>
									</li>
									<li>
										<a href="#" data-theme="_bgpd"  onclick="self.location='http://192.168.0.77:7001/newnewnew/UpdateDocument.html';">내 서류 변경</a>
									</li>
									<li>
										<a href="#" data-theme="_bgpd" >내 서류 열람 허가</a>
									</li>

							</ul>
					</li>
					 
					<li>
						<a href="#" data-theme="_bgp" >판매자</a>
						<ul>
							<li>
								<a href="#" onclick="self.location='http://192.168.0.77:7001/newnewnew/RegisterSeller.html';" data-theme="_bgpd">판매자 등록</a>
							</li>
							<li>
								<a href="#" data-theme="_bgpd"  onclick="self.location='http://192.168.0.77:7001/newnewnew/UploadDocument.html';">서류 등록</a>
							</li>

							<li>
								<a href="#" onclick="self.location='http://192.168.0.77:7001/newnewnew/UploadProduct.html';" data-theme="_bgpd">매물 등록</a>
							</li>
							<li>
								<a href="#" onclick="self.location='http://192.168.0.77:7001/newnewnew/UpdateProduct.html';" data-theme="_bgpd">매물 변경</a>
							</li>
							<li>
								<a href="#"  onclick="self.location='http://192.168.0.77:7001/newnewnew/MyProducts.html';" data-theme="_bgpd">내 매물</a>
							</li>
							<li>
								<a href="#"  onclick="self.location='http://192.168.0.77:7001/newnewnew/SellerCreateContract.html';" data-theme="_bgpd">계약 관리</a>
							</li>
						</ul>
					</li>

					<li>
						<a href="#" data-theme="_bgp">구매자</a>
						<ul>
							<li>
								<a href="#" onclick="self.location='http://192.168.0.77:7001/newnewnew/RegisterBuyer.html';" data-theme="_bgpd">구매자 등록</a>
							</li>
							<li>
								<a href="#" data-theme="_bgpd"  onclick="self.location='http://192.168.0.77:7001/newnewnew/UploadDocument.html';">서류 등록</a>
							</li>
							<li>
								<a href="#" data-theme="_bgpd"  onclick="self.location='http://192.168.0.77:7001/newnewnew/BuyerCreateContract.html';">계약 관리</a>
							</li>
							<li>
									<a href="#" data-theme="_bgpd"  onclick="self.location='http://192.168.0.77:7001/newnewnew/GiveStar.html';">평점 주기</a>
							</li>
						
						</ul>
					</li>

					<li>
						<a href="#" data-theme="_bgp">메뉴 4</a>
					</li>
					<li>
						<a href="#" data-theme="_bgp">메뉴 5</a>
					</li>
					<li>
						<a href="#" data-theme="_bgp">메뉴 6</a>
						<ul>
							<li>
								<a href="#" data-theme="_bgpd">Sub-Menu Item</a>
							</li>
							<li>
								<a href="#" data-theme="_bgpd">Sub-Menu Item long title</a>
							</li>
							<li>
								<a href="#" data-theme="_bgpd">Sub-Menu Item</a>
							</li>
						</ul>
					</li>
				</ul>
			</nav>
		</div>
	</section>
<section class="MOD_SUBNAVIGATION1">
  <div data-layout="_r">
	 
    <div data-layout="al16 al-o2 de-o1 de6 ec4">
		
      <nav class="MOD_SUBNAVIGATION1_Menu" data-theme="_bo2">
	
		<p class="MOD_SUBNAVIGATION1_Menutitle" data-theme="_bgs"></p>
		
		<ul>
			<li>
				<a id="tag0" onclick="TagChange(this.id)">ALL</a>
			</li>
			<li>
				<a id="tag1" onclick="TagChange(this.id)">아파트</a>
			</li>
			<li>
				<a id="tag2" onclick="TagChange(this.id)">빌딩</a>
			</li>
			<li>
				<a id="tag3" onclick="TagChange(this.id)">빌라</a>
			</li>
			<li>
				<a id="tag4" onclick="TagChange(this.id)">주택</a>
			</li>
			<li>
				<a href="#">미정</a>
			</li>
			<li>
				<a href="#">미정</a>
			</li>
		
		</ul>
      </nav>
    </div>
    
    <div data-layout="al-o1 de-o2 de10" class="MOD_SUBNAVIGATION1_Page">
        <section class="MOD_FEATURE">
            <div id="TGT" class="content" data-layout="_r"> 
              <!-- <div data-layout="ch8 ec4">
                <a href="#" class="MOD_FEATURE_Container">
                  <img class="MOD_FEATURE_Picture" id="Pic0" alt="">
                  <div class="MOD_FEATURE_TextContainer">
                    <p class="MOD_FEATURE_Title" id="PicTitle0" data-theme="_ts2"></p>
                    <p class="MOD_FEATURE_Description" id="PicInfo0"></p>
                    <p class="MOD_FEATURE_Description" id="PicPrice0"></p>
                    <p class="MOD_FEATURE_Description" id="Picowner0"></p>
                  </div>
                </a>
              </div> -->
              
            </div>
            <div class="MOD_BLOGROLL1_Pagination">
              <ul>
                <li><a href="#">&xlArr; Previous</a></li>
                <li><a  href="#">1</a></li>
                <li><a href="#">2</a></li>
                <li><a href="#">3</a></li>
                <li><a href="#">4</a></li>
                <li><a  href="#">Next &xrArr;</a></li>
              </ul>
            </div>
          </section>
          
      </div>
  </div>

</section>
<footer>
  <div class="MOD_FOOTER1" data-theme="_bgd">
    <div data-layout="_r">
      <div data-layout="ch8 ec4">
        <h3 >Project 7조</h3>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna
          aliqua. </p>
      </div>
      <div data-layout="al16 ch8 ec4 ec-n4">
        <h3>Links</h3>
        <nav>
          <ul>
            <li>
              <a href="#">Footer Link 1</a>
            </li>
            <li>
              <a href="#">Footer Link 2</a>
            </li>
            <li>
              <a href="#">Footer Link 3</a>
            </li>
            <li>
              <a href="#">Footer Link 4</a>
            </li>
            <li>
              <a href="#">Footer Link 5</a>
            </li>
          </ul>
        </nav>
      </div>
      <div data-layout="ch8 ec4">
        <h3>Contact Details</h3>
        <p>Email:
          <a href="mailto:#">email@email.com</a>
          <br>Phone:
          <a href="tel:#">01234 567 8910</a>
        </p>
        <address>
          123 The High Street
          <br> The Town
          <br> The City
          <br> County / State
          <br> Postal / Zip Code
        </address>
      </div>
    </div>
  </div>
  <div class="MOD_FOOTER1_Copyright" data-theme="_bgvd">
    <div data-layout="_r" class="nopadding">
      <div data-layout="al16">
        <p>Copyright &copy; 2017 Company</p>
      </div>
    </div>
  </div>
</footer>
<script src="./modul.js"></script>
</body>

<script type="text/javascript">



  var RealEstateTransactionContract;
  var RealEstateTransactionStorage;
  
  var imageArray = new Array();
  var Tag;
  var count = 0; //상품 배열 최대크기
  var index = 0; //인덱스용 (상품 삽입)


  //동적생성 전역
  var div1;
  var a;
  var tagetimg;
  var divcontainer;
  var p1itle;
  var p1info;
  var p1price;
  var p1owner;
  var create = 0;
  var lTag;
  var Productindex;
  var tagid;



  window.addEventListener('load', function () {

    // Checking if Web3 has been injected by the browser (Mist/MetaMask)
    if (typeof web3 !== 'undefined') {
      // Use Mist/MetaMask's provider
      window.web3 = new Web3(web3.currentProvider);
    } else {
      console.log('No web3? You should consider trying MetaMask!')
      // fallback - use your fallback strategy (local node / hosted node + in-dapp id mgmt / fail)
      window.web3 = new Web3(new Web3.providers.HttpProvider("http://192.168.0.77:7001"));
    }
    // Now you can start your app & access web3 freely:

    startApp();
	
  });

  function startApp() {
    RealEstateTransactionContract = web3.eth.contract(abi);
    RealEstateTransactionStorage = RealEstateTransactionContract.at(contractAddress);


    //   document.getElementById('contractAddr').innerHTML = getLink(contractAddress);
	var catchindex = location.href.split("#");

	if(catchindex.length > 1)
	{
		tagid = catchindex[1];
	}
	else{
		tagid ="tag0"
	}

    LoadProducts(tagid);

	
  }
  //상품 진열자리 동적생성
  function createLocation(){
  
        div1 = document.createElement("div");
        div1.setAttribute("id","TGTT"+create)
        div1.setAttribute("data-layout","ch8 ec4")
        document.getElementById("TGT").appendChild(div1);

        a =  document.createElement("a");
        a.setAttribute("id","TGTTT"+create);
        // a.setAttribute("href","#");
        a.setAttribute("class","MOD_FEATURE_Container");
		a.setAttribute("onclick","OnClickProduct(this.id)");
				
				// a.setAttribute("onclick","self.location='http://192.168.0.77:7001/newnewnew/ClickProduct.html';");
			

        document.getElementById("TGTT"+create).appendChild(a);

        tagetimg = document.createElement("img");
        tagetimg.setAttribute("id","Pic"+create);
        tagetimg.setAttribute("class","MOD_FEATURE_Picture");
        tagetimg.setAttribute("alt","");
        document.getElementById("TGTTT"+create).appendChild(tagetimg);

         divcontainer =  document.createElement("div");
         divcontainer.setAttribute("id","TGTTTT"+create);
         divcontainer.setAttribute("class","MOD_FEATURE_TextContainer");
         document.getElementById("TGTTT"+create).appendChild(divcontainer);

         p1itle =document.createElement("p");
         p1itle.setAttribute("id","PicTitle"+create);
         p1itle.setAttribute("class","MOD_FEATURE_Title");
         p1itle.setAttribute("data-theme","_ts2");
         document.getElementById("TGTTTT"+create).appendChild(p1itle);

         p1info = document.createElement("p");
         p1info.setAttribute("id","PicInfo"+create);
         p1info.setAttribute("class","MOD_FEATURE_Description");
         document.getElementById("TGTTTT"+create).appendChild(p1info);

         
         p1price = document.createElement("p");
         p1price.setAttribute("id","PicPrice"+create);
         p1price.setAttribute("class","MOD_FEATURE_Description");
         document.getElementById("TGTTTT"+create).appendChild(p1price);

         p1owner = document.createElement("p");
         p1owner.setAttribute("id","Picowner"+create);
         p1owner.setAttribute("class","MOD_FEATURE_Description");
         document.getElementById("TGTTTT"+create).appendChild(p1owner);

         lTag = document.createElement("p");
         lTag.setAttribute("id","Tag"+create);
         lTag.setAttribute("class","MOD_FEATURE_Description");
         document.getElementById("TGTTTT"+create).appendChild(lTag);

				 Productindex = document.createElement("p");
         Productindex.setAttribute("id","Productindex"+create);
         Productindex.setAttribute("class","MOD_FEATURE_Description");
         document.getElementById("TGTTTT"+create).appendChild(Productindex);
   
  
      
  }
  function OnClickProduct(proindex)
	{
		var table =proindex.split('TTT');
		var realpruindex = document.getElementById("Productindex"+table[1]).textContent;
		
		 window.open("ClickProduct.html?create:"+realpruindex,"_self");

	}
	
  //모든 상품 불러오기
  function LoadProducts(_tagid) {

    RealEstateTransactionStorage.GetProdctsSize(function (e, r) {
      //상품배열 크기 받아오기
      count = r.c["0"]
      //상품배열 크기가 현재 상품 진열크기보다 크면 호출

      //배열의 크기만큼 상품 받아오기
	 
      for (var i = 0; i < count; i++) {
        RealEstateTransactionStorage.productArray(i, function (e, r) {
			if(tagid == "tag0")
			{
				createLocation(create);
				InsertProduct(r);
				create++
			}
			else if(tagid == "tag1" && r[3] == "아파트")
			{
				createLocation(create);
				InsertProduct(r);
				create++
			}
			else if(tagid == "tag2" && r[3] == "빌딩")
			{
				createLocation(create);
				InsertProduct(r);
				create++
			}
			else if(tagid == "tag3" && r[3] == "빌라")
			{
				createLocation(create);
				InsertProduct(r);
				create++
			}
			else if(tagid == "tag4" && r[3] == "주택")
			{
				createLocation(create);
				InsertProduct(r);
				create++
			}
			
        })

      }

    })
  }

	function InsertProduct(r) {
		var Pic = document.getElementById('Pic' + index);
		imageArray = r[5].split('##');
		var convert = r[2] / 10 ** 18;
		document.getElementById('PicPrice' + index).innerHTML = convert + ' <span style="color: blueviolet; font-weight:bold">ETH</span>';
		document.getElementById('PicInfo' + index).innerHTML = r[1];
		document.getElementById('PicTitle' + index).innerHTML = r[4];
		document.getElementById('Tag' + index).innerHTML = r[3];
		document.getElementById('Productindex' + index).innerHTML = "No." + r[7];
		let ShowProducturl = "http://ipfs.io/ipfs/" + imageArray[0];
		Pic.src = ShowProducturl;
		Pic.width = 200;
		Pic.height = 200;
		index++;
	}


  function TagChange(_tagid){
	document.getElementById('TGT').innerHTML = "";
	 history.replaceState({}, null, location.pathname);
	 window.open("Main.html?#"+_tagid,"_self");
  }
  
  function getLink(addr) {
    return '<a target="_blank" href=https://testnet.etherscan.io/address/' + addr + '>' + addr + '</a>';
  }

</script>

</html>